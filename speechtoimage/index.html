<!-- A HTML web page using jQuery and openai's image generation 
    that also utilises chrome speechkit to listen to commands and display an image generated by openai -->
<!-- import socketio client -->
<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>

<!DOCTYPE html>
<html>
  <head>
    <!-- include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- include openai's image generation -->

    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script>

    <script>
      var socket = io.connect("https://americanaparallel:4012");

      $(function () {
        // listen to commands and display an image generated by openai
        annyang.start({ autoRestart: true, continuous: false });

        annyang.addCallback("result", function (heardArray) {
          var text = heardArray[0];
          $("#spoken").html(text);
          getUnsplashImage(text);
          generateImage(text);
        });

        /**
         * generateImage
         * @param {string} text - the text to generate an image from
         */
        function generateImage(text) {
          // replace image with a loading gif
          $("#imageOutput").html(
            '<img src="https://media.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif" />'
          );

          var now = new Date().getTime();
          // send the text to the server
          socket.emit("message", text);
          // listen for the image
          socket.on("image", function (image) {
            // display the image
            var nowThen = new Date().getTime();

            $("#imageOutput").html(
              `<img src="${image}" /><br>OpenAI: ${nowThen - now}ms`
            );
          });
        }

        // handle the generate button click
        $("#generateButton").click(function () {
          // get the text from the text input
          var text = $("#textInput").val();
          // generate an image
          generateImage(text);
        });
      });
    </script>
    <title>Image Generation</title>
  </head>
  <body>
    <p id="header">
      OpenAI vs Unsplash Comparison, NodeJS, Express, SocketIO, Annyang Speech
    </p>
    <p id="spoken">Speak to generate an image. Say for example: "A cat"...</p>
    <div class="content">
      <div id="images">
        <div id="imageOutput"></div>
        <div id="imageOutput2"></div>
      </div>
    </div>
  </body>
</html>

<script>
  // use unsplash api to get an image based on a query

  // get the image from unsplash
  function getUnsplashImage(query) {
    // get the image from unsplash
    var now = new Date().getTime();
    $.ajax({
      url: "https://api.unsplash.com/search/photos",
      data: {
        query: query,
        client_id: "hoWOwy_2K3IkfGFEqJIIIw98RNQnagQABQf_0q6lDJ0",
      },
      success: function (data) {
        // get the image url
        var image = data.results[0].urls.regular;
        // send the image to the client
        var nowThen = new Date().getTime();
        $("#imageOutput2").html(
          `<img style="width:256px;" src="${image}" /><br>Unsplash: ${
            nowThen - now
          }ms`
        );
      },
    });
  }
</script>

<style>
  body {
    margin: 0;
    padding: 0;
    background-color: #000;
    height: 100%;
    width: 100%;
    color: white;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  }

  /* make the content absolute and give it a zIndex over the img, also give the text white background */
  .content {
    z-index: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    margin-top: -100px;
  }

  #spoken,
  #header {
    color: black;
    text-align: center;
    font-size: 20px;
    text-transform: capitalize;
  }

  #spoken {
    font-family: "Courier New", Courier, monospace;
  }

  #images {
    display: block;
  }

  #images div {
    display: inline-block;
    margin: 10px;
  }

  /* make it look nice, with a nice font */
  p {
    background-color: white;
    padding: 10px;
    margin: 0;
  }
</style>
